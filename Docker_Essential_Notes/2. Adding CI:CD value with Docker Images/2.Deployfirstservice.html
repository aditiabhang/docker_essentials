<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_wq9588dcc7k6-3.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-3 0}.lst-kix_wq9588dcc7k6-7>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-7}.lst-kix_wq9588dcc7k6-7>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-7,lower-latin) ". "}.lst-kix_wq9588dcc7k6-6>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-6,decimal) ". "}.lst-kix_wq9588dcc7k6-8>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-8,lower-roman) ". "}ol.lst-kix_wq9588dcc7k6-8.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-8 0}ol.lst-kix_wq9588dcc7k6-2{list-style-type:none}ol.lst-kix_wq9588dcc7k6-1{list-style-type:none}ol.lst-kix_wq9588dcc7k6-0{list-style-type:none}.lst-kix_wq9588dcc7k6-5>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-5}ol.lst-kix_wq9588dcc7k6-0.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-0 0}ol.lst-kix_wq9588dcc7k6-6{list-style-type:none}ol.lst-kix_wq9588dcc7k6-5{list-style-type:none}ol.lst-kix_wq9588dcc7k6-4{list-style-type:none}ol.lst-kix_wq9588dcc7k6-3{list-style-type:none}.lst-kix_wq9588dcc7k6-8>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-8}ol.lst-kix_wq9588dcc7k6-7.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-7 0}ol.lst-kix_wq9588dcc7k6-5.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-5 0}ol.lst-kix_wq9588dcc7k6-8{list-style-type:none}ol.lst-kix_wq9588dcc7k6-7{list-style-type:none}.lst-kix_wq9588dcc7k6-1>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-1}.lst-kix_wq9588dcc7k6-4>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-4}ol.lst-kix_wq9588dcc7k6-2.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-2 0}.lst-kix_wq9588dcc7k6-0>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-0}.lst-kix_wq9588dcc7k6-3>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-3}.lst-kix_wq9588dcc7k6-0>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-0,decimal) ". "}ol.lst-kix_wq9588dcc7k6-4.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-4 0}.lst-kix_wq9588dcc7k6-3>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-3,decimal) ". "}ol.lst-kix_wq9588dcc7k6-6.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-6 0}.lst-kix_wq9588dcc7k6-2>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-2,lower-roman) ". "}.lst-kix_wq9588dcc7k6-2>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-2}.lst-kix_wq9588dcc7k6-4>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-4,lower-latin) ". "}.lst-kix_wq9588dcc7k6-1>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-1,lower-latin) ". "}.lst-kix_wq9588dcc7k6-5>li:before{content:"" counter(lst-ctn-kix_wq9588dcc7k6-5,lower-roman) ". "}ol.lst-kix_wq9588dcc7k6-1.start{counter-reset:lst-ctn-kix_wq9588dcc7k6-1 0}.lst-kix_wq9588dcc7k6-6>li{counter-increment:lst-ctn-kix_wq9588dcc7k6-6}ol{margin:0;padding:0}table td,table th{padding:0}.c7{margin-left:36pt;padding-top:24pt;padding-left:0pt;padding-bottom:43pt;line-height:1.3999999999999997;orphans:2;widows:2;text-align:left}.c11{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c1{color:#3c3c3c;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Courier New";font-style:normal}.c13{background-color:#ffffff;padding-top:0pt;padding-bottom:19pt;line-height:1.4;orphans:2;widows:2;text-align:left}.c3{color:#373a3c;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:17pt;font-family:"Arial";font-style:normal}.c0{color:#3c3c3c;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Verdana";font-style:normal}.c6{background-color:#ffffff;padding-top:15pt;padding-bottom:28pt;line-height:1.4;orphans:2;widows:2;text-align:left}.c12{background-color:#ffffff;padding-top:0pt;padding-bottom:28pt;line-height:1.4;orphans:2;widows:2;text-align:left}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c10{text-decoration:none;vertical-align:baseline;font-size:12pt;font-style:normal}.c4{font-size:12pt;font-family:"Verdana";color:#3c3c3c;font-weight:400}.c8{font-family:"Courier New";color:#3c3c3c;font-weight:400}.c15{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c5{padding:0;margin:0}.c9{font-size:10pt}.c14{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c15"><h3 class="c13" id="h.pe1fapqfd4o"><span class="c3">Deploy your first service</span></h3><p class="c12"><span class="c0">Now that you have your three-node Swarm cluster initialized, you&#39;ll deploy some containers. To run containers on a Docker Swarm, you need to create a service. A service is an abstraction that represents multiple containers of the same image deployed across a distributed cluster.</span></p><p class="c6"><span class="c0">Let&#39;s do a simple example using NGINX. For now, you will create a service with one running container, but you will scale up later.</span></p><p class="c2"><span class="c4">Deploy a service by using NGINX:<br></span><span class="c1">$ docker service create --detach=true --name nginx1 --publish 80:80 &nbsp;--mount source=/etc/hostname,target=/usr/share/nginx/html/index.html,type=bind,ro nginx:1.12</span></p><p class="c2"><span class="c8 c9">pgqdxr41dpy8qwkn6qm7vke0q</span></p><ol class="c5 lst-kix_wq9588dcc7k6-0 start" start="1"><li class="c7"><span class="c4">This command statement is declarative, and Docker Swarm will try to maintain the state declared in this command unless explicitly changed by another </span><span class="c8">docker service</span><span class="c4">&nbsp;command. This behavior is useful when nodes go down, for example, and containers are automatically rescheduled on other nodes. You will see a demonstration of that a little later in this lab.<br>The </span><span class="c8">--mount</span><span class="c4">&nbsp;flag is useful to have NGINX print out the hostname of the node it&#39;s running on. You will use this later in this lab when you start load balancing between multiple containers of NGINX that are distributed across different nodes in the cluster and you want to see which node in the swarm is serving the request.<br>You are using NGINX tag </span><span class="c8">1.12</span><span class="c4">&nbsp;in this command. You will see a rolling update with version 1.13 later in this lab.<br>The </span><span class="c8">--publish</span><span class="c0">&nbsp;command uses the swarm&#39;s built-in routing mesh. In this case, port 80 is exposed on every node in the swarm. The routing mesh will route a request coming in on port 80 to one of the nodes running the container.</span></li></ol><p class="c2"><span class="c4">Inspect the service. &nbsp;Use the command </span><span class="c8">docker service ls</span><span class="c4">&nbsp;to inspect the service you just created:<br></span><span class="c1">$ docker service ls</span></p><p class="c2"><span class="c1">ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MODE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;REPLICAS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PORTS</span></p><p class="c2"><span class="c1">pgqdxr41dpy8 &nbsp; &nbsp; &nbsp; &nbsp;nginx1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;replicated &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1/1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nginx:1.12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*:80-&gt;80/tcp</span></p><ol class="c5 lst-kix_wq9588dcc7k6-0" start="2"><li class="c7"><span class="c4">Check the running container of the service.<br>To take a deeper look at the running tasks, use the command </span><span class="c8">docker service ps</span><span class="c0">. A task is another abstraction in Docker Swarm that represents the running instances of a service. In this case, there is a 1-1 mapping between a task and a container.</span></li></ol><p class="c2"><span class="c1">$ docker service ps nginx1</span></p><p class="c2"><span class="c1">ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NODE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DESIRED STATE &nbsp; &nbsp; &nbsp; CURRENT STATE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ERROR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PORTS</span></p><p class="c2"><span class="c8 c9">iu3ksewv7qf9 &nbsp; &nbsp; &nbsp; &nbsp;nginx1.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nginx:1.12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;node1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Running &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Running 8 minutes ago</span></p><ol class="c5 lst-kix_wq9588dcc7k6-0" start="3"><li class="c7"><span class="c4">If you know which node your container is running on (you can see which node based on the output from </span><span class="c8">docker service ps</span><span class="c4">), you can use the command </span><span class="c8">docker container ls</span><span class="c0">&nbsp;to see the container running on that specific node.</span></li></ol><p class="c2"><span class="c0">Test the service.<br>Because of the routing mesh, you can send a request to any node of the swarm on port 80. This request will be automatically routed to the one node that is running the NGINX container.<br>Try this command on each node:</span></p><p class="c2"><span class="c4"><br></span><span class="c1">$ curl localhost:80</span></p><p class="c2"><span class="c1">node1</span></p><ol class="c5 lst-kix_wq9588dcc7k6-0" start="4"><li class="c7"><span class="c0">Curling will output the hostname where the container is running. For this example, it is running on node1, but yours might be different.</span></li></ol><p class="c2 c14"><span class="c11"></span></p></body></html>